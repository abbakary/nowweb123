{% extends 'base.html' %}

{% block title %}My Dashboard - ResearchHub{% endblock %}

{% block content %}
<section style="padding: 30px 20px;">
    <div class="container-main">
        <div style="margin-bottom: 30px;">
            <h2 style="color: var(--primary); margin-bottom: 10px;">
                <i class="ri-user-3-line"></i> My Dashboard
            </h2>
            <p style="color: #666;">Track your service requests and workshop registrations</p>
        </div>

        <!-- Tabs -->
        <div style="background: white; border-bottom: 1px solid #eee; margin-bottom: 30px;">
            <div style="display: flex; gap: 20px;">
                <a href="#requests" style="padding: 15px 20px; text-decoration: none; color: var(--primary); border-bottom: 3px solid var(--primary); font-weight: 600;">
                    <i class="ri-inbox-line"></i> Service Requests ({{ service_requests.count }})
                </a>
                <a href="#workshops" style="padding: 15px 20px; text-decoration: none; color: #666; border-bottom: 3px solid transparent; font-weight: 600;">
                    <i class="ri-presentation-line"></i> Workshops ({{ workshop_registrations.count }})
                </a>
            </div>
        </div>

        <!-- Service Requests -->
        <div id="requests">
            <div style="margin-bottom: 20px;">
                <h3 style="color: var(--primary);">My Service Requests</h3>
            </div>

            {% if service_requests %}
                <div class="row g-3">
                    {% for request in service_requests %}
                    <div class="col-lg-6">
                        <div style="background: white; border: 1px solid #eee; border-radius: var(--border-radius); padding: 20px;">
                            <!-- Status Badge -->
                            <div style="margin-bottom: 15px;">
                                {% if request.status == 'pending' %}
                                    <span style="background: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; font-weight: 600;">
                                        <i class="ri-time-line"></i> Pending
                                    </span>
                                {% elif request.status == 'accepted' %}
                                    <span style="background: #cce5ff; color: #004085; padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; font-weight: 600;">
                                        <i class="ri-checkbox-circle-line"></i> Accepted
                                    </span>
                                {% elif request.status == 'in_progress' %}
                                    <span style="background: #d1ecf1; color: #0c5460; padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; font-weight: 600;">
                                        <i class="ri-loader-4-line"></i> In Progress
                                    </span>
                                {% elif request.status == 'completed' %}
                                    <span style="background: #d4edda; color: #155724; padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; font-weight: 600;">
                                        <i class="ri-check-line"></i> Completed
                                    </span>
                                {% endif %}
                            </div>

                            <h5 style="color: var(--primary); margin-bottom: 10px;">{{ request.title }}</h5>
                            
                            {% if request.service %}
                            <p style="color: #666; margin-bottom: 10px;">
                                <strong>Service:</strong> {{ request.service.name }}
                            </p>
                            {% endif %}

                            <p style="color: #666; margin-bottom: 10px;">
                                <strong>Submitted:</strong> {{ request.created_at|date:"M d, Y" }}
                            </p>

                            {% if request.deadline %}
                            <p style="color: #666; margin-bottom: 10px;">
                                <strong>Deadline:</strong> {{ request.deadline|date:"M d, Y" }}
                            </p>
                            {% endif %}

                            <p style="color: #666; margin-bottom: 15px;">{{ request.description|truncatewords:30 }}</p>

                            <a href="#" class="cta-button" style="font-size: 0.9rem; padding: 8px 15px;">
                                View Details
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="background: var(--light); padding: 40px; text-align: center; border-radius: var(--border-radius);">
                    <div style="font-size: 2.5rem; color: #ccc; margin-bottom: 15px;">
                        <i class="ri-inbox-line"></i>
                    </div>
                    <h5 style="color: var(--primary);">No Service Requests Yet</h5>
                    <p style="color: #666; margin-bottom: 20px;">Start by requesting one of our services</p>
                    <a href="{% url 'services' %}" class="cta-button" style="font-size: 0.9rem; padding: 10px 25px;">
                        Browse Services
                    </a>
                </div>
            {% endif %}
        </div>

        <!-- Workshops -->
        <div id="workshops" style="margin-top: 50px;">
            <div style="margin-bottom: 20px;">
                <h3 style="color: var(--primary);">My Workshop Registrations</h3>
            </div>

            {% if workshop_registrations %}
                <div class="row g-3">
                    {% for registration in workshop_registrations %}
                    <div class="col-lg-6">
                        <div style="background: white; border: 1px solid #eee; border-radius: var(--border-radius); padding: 20px;">
                            <!-- Status Badge -->
                            <div style="margin-bottom: 15px;">
                                {% if registration.status == 'registered' %}
                                    <span style="background: #d1ecf1; color: #0c5460; padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; font-weight: 600;">
                                        <i class="ri-checkbox-circle-line"></i> Registered
                                    </span>
                                {% elif registration.status == 'attended' %}
                                    <span style="background: #d4edda; color: #155724; padding: 5px 10px; border-radius: 4px; font-size: 0.85rem; font-weight: 600;">
                                        <i class="ri-check-line"></i> Attended
                                    </span>
                                {% endif %}
                            </div>

                            <h5 style="color: var(--primary); margin-bottom: 10px;">{{ registration.workshop.title }}</h5>

                            <p style="color: #666; margin-bottom: 10px;">
                                <i class="ri-calendar-line"></i> {{ registration.workshop.date|date:"M d, Y H:i" }}
                            </p>

                            {% if registration.workshop.is_online %}
                            <p style="color: #666; margin-bottom: 10px;">
                                <i class="ri-video-on-line"></i> Online Workshop
                                {% if registration.workshop.online_link %}
                                    <a href="{{ registration.workshop.online_link }}" target="_blank" style="color: var(--primary); margin-left: 10px;">
                                        Join Meeting â†’
                                    </a>
                                {% endif %}
                            </p>
                            {% else %}
                            <p style="color: #666; margin-bottom: 10px;">
                                <i class="ri-map-pin-line"></i> {{ registration.workshop.location }}
                            </p>
                            {% endif %}

                            <p style="color: #666; margin-bottom: 15px;">{{ registration.workshop.description|truncatewords:20 }}</p>

                            <a href="{% url 'workshop_detail' registration.workshop.id %}" class="cta-button" style="font-size: 0.9rem; padding: 8px 15px;">
                                View Workshop
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="background: var(--light); padding: 40px; text-align: center; border-radius: var(--border-radius);">
                    <div style="font-size: 2.5rem; color: #ccc; margin-bottom: 15px;">
                        <i class="ri-presentation-line"></i>
                    </div>
                    <h5 style="color: var(--primary);">No Workshop Registrations</h5>
                    <p style="color: #666; margin-bottom: 20px;">Check out our upcoming workshops</p>
                    <a href="{% url 'services' %}" class="cta-button" style="font-size: 0.9rem; padding: 10px 25px;">
                        View Workshops
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
