{% extends 'admin/base.html' %}

{% block title %}Manage Testimonials - Admin{% endblock %}
{% block page_title %}Testimonials Management{% endblock %}

{% block content %}
<div class="admin-card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div class="admin-card-title" style="margin-bottom: 0;">
            <i class="ri-chat-quote-line"></i> Client Testimonials
        </div>
    </div>
    
    <!-- Filters -->
    <div style="margin-bottom: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <select class="form-control" style="border-radius: var(--border-radius);">
            <option value="">All Status</option>
            <option value="published">Published</option>
            <option value="draft">Draft</option>
        </select>
        <select class="form-control" style="border-radius: var(--border-radius);">
            <option value="">All Ratings</option>
            <option value="5">5 Stars</option>
            <option value="4">4 Stars</option>
            <option value="3">3 Stars</option>
        </select>
    </div>
    
    {% if testimonials %}
        <div style="display: grid; gap: 20px;">
            {% for testimonial in testimonials %}
            <div style="background: white; border: 1px solid #e0e0e0; padding: 20px; border-radius: var(--border-radius); display: grid; grid-template-columns: 1fr auto; gap: 20px;">
                <div>
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                            {{ testimonial.customer.full_name|first|upper }}
                        </div>
                        <div>
                            <p style="margin: 0; font-weight: 600;">{{ testimonial.customer.full_name }}</p>
                            <small style="color: #999;">{{ testimonial.created_at|date:"M d, Y" }}</small>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        {% for i in "12345" %}
                            {% if forloop.counter <= testimonial.rating %}
                                <i class="ri-star-fill" style="color: #f39c12; font-size: 0.9rem;"></i>
                            {% else %}
                                <i class="ri-star-line" style="color: #ddd; font-size: 0.9rem;"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    
                    <p style="color: #333; margin: 10px 0;">{{ testimonial.quote }}</p>
                    
                    {% if testimonial.service %}
                        <small style="color: #666;">
                            <i class="ri-file-text-line"></i> Service: {{ testimonial.service.name }}
                        </small>
                    {% endif %}
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 10px; justify-content: center;">
                    <div style="text-align: right;">
                        {% if testimonial.is_published %}
                            <span class="admin-badge admin-badge-success" style="margin-bottom: 10px;">Published</span><br>
                        {% else %}
                            <span class="admin-badge admin-badge-warning" style="margin-bottom: 10px;">Draft</span><br>
                        {% endif %}
                        
                        {% if testimonial.is_featured %}
                            <small style="color: var(--accent); font-weight: 600;">
                                <i class="ri-star-fill"></i> Featured
                            </small>
                        {% endif %}
                    </div>
                    
                    <form method="POST" style="display: flex; flex-direction: column; gap: 8px;">
                        {% csrf_token %}
                        <input type="hidden" name="testimonial_id" value="{{ testimonial.id }}">
                        
                        {% if not testimonial.is_published %}
                            <button type="submit" name="action" value="publish" class="admin-btn admin-btn-primary" style="padding: 6px 12px; font-size: 0.8rem;">
                                <i class="ri-check-line"></i> Publish
                            </button>
                        {% else %}
                            <button type="submit" name="action" value="unpublish" class="admin-btn admin-btn-secondary" style="padding: 6px 12px; font-size: 0.8rem;">
                                <i class="ri-close-line"></i> Unpublish
                            </button>
                        {% endif %}
                        
                        <button type="submit" name="action" value="feature" class="admin-btn admin-btn-secondary" style="padding: 6px 12px; font-size: 0.8rem;">
                            <i class="ri-star-line"></i> {% if testimonial.is_featured %}Unfeature{% else %}Feature{% endif %}
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <i class="ri-chat-quote-line"></i>
            <p>No testimonials yet</p>
        </div>
    {% endif %}
</div>

<!-- Stats -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
    <div class="stat-card">
        <div class="stat-label"><i class="ri-file-list-line"></i> Total Testimonials</div>
        <div class="stat-value">{{ testimonials|length|default:"0" }}</div>
    </div>
    
    <div class="stat-card accent">
        <div class="stat-label"><i class="ri-check-line"></i> Published</div>
        <div class="stat-value">{{ published_count|default:"0" }}</div>
    </div>
    
    <div class="stat-card success">
        <div class="stat-label"><i class="ri-star-fill"></i> Featured</div>
        <div class="stat-value">{{ featured_count|default:"0" }}</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label"><i class="ri-star-line"></i> Avg. Rating</div>
        <div class="stat-value">{{ avg_rating|default:"â€”" }}</div>
    </div>
</div>
{% endblock %}
